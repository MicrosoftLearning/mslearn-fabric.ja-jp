---
lab:
  title: セマンティック モデルを作成および探索する
  module: Understand scalability in Power BI
---

# セマンティック モデルを作成および探索する

この演習では、Microsoft Fabric を使用して、データ ウェアハウス内の NY タクシーのサンプル データのデータ モデルを開発します。

演習する内容は次のとおりです。

- Fabric データ ウェアハウスからカスタム セマンティック モデルを作成する。
- リレーションシップを作成し、モデル ダイアグラムを整理する。
- Fabric でセマンティック モデル内のデータを直接探索する。

このラボの所要時間は約 **30** 分です。

> **注**:この演習を完了するには、[Microsoft Fabric 試用版](https://learn.microsoft.com/fabric/get-started/fabric-trial)が必要です。

## ワークスペースの作成

Fabric でデータを操作する前に、Fabric 試用版を有効にしてワークスペースを作成してください。

1. [Microsoft Fabric ホーム ページ](https://app.fabric.microsoft.com/home?experience=fabric) (`https://app.fabric.microsoft.com/home?experience=fabric`) で、**[Synapse Data Engineering]** を選択します。
1. 左側のメニュー バーで、 **[ワークスペース]** を選択します (アイコンは &#128455; に似ています)。
1. 任意の名前で新しいワークスペースを作成し、Fabric 容量を含むライセンス モード ("試用版"、*Premium*、または *Fabric*) を選択します。**
1. 開いた新しいワークスペースは空のはずです。

## データ ウェアハウスを作成してサンプル データを読み込む

これでワークスペースが作成されたので、次にデータ ウェアハウスを作成します。 Synapse Data Warehouse のホーム ページには、新しいウェアハウスを作成するためのショートカットがあります。

1. **Synapse Data Warehouse** ホーム ページで、新しい**ウェアハウス**を任意の名前を付けて作成します。

    1 分ほどで、新しいレイクハウスが作成されます。
    
    ![新しいウェアハウスのスクリーンショット](./Images/new-data-warehouse2.png)

1. データ ウェアハウスのユーザー インターフェイスの中央には、ウェアハウスにデータを読み込む方法がいくつか表示されます。 **[Sample data] (サンプル データ)** を選択して、NYC のタクシーのデータを読み込みます。 作成には数分かかります。

1. サンプル データが読み込まれたら、左側の **[エクスプローラー]** ペインを使用して、サンプル データ ウェアハウスに既に存在するテーブルとビューを確認します。

1. リボンの **[レポートの作成]** タブを選択し、**[New semantic model] (新しいセマンティック モデル)** を選択します。 これで、データ チームや業務でレポートの作成に使用するために、データ ウェアハウスの特定のテーブルとビューのみを使用した新しいセマンティック モデルを作成できます。

1. セマンティック モデルに **Taxi Revenue** という名前を付け、作成したワークスペース内にそれがあることを確認し、次の表を選択します。
   - 日
   - Trip
   - 地理的な場所
   - Weather
     
   ![4 つのテーブルが選択された [New semantic model] (新しいセマンティック モデル) インターフェイスのスクリーンショット](./Images/new-semantic-model.png)
     
## テーブル間のリレーションシップを作成する

次に、データを正確に分析して視覚化するために、テーブル間のリレーションシップを作成します。 Power BI Desktop でのリレーションシップの作成に慣れている方にとっては、見覚えのある内容です。

1. ワークスペースに戻り、新しいセマンティック モデル、Taxi Revenue が表示されることを確認します。 項目の種類が、データ ウェアハウスの作成時に自動的に作成される **[Semantic model (default)] (セマンティック モデル (既定))** ではなく、**[Semantic model] (セマンティック モデル)** であることに注意してください。

     *注:Microsoft Fabric でウェアハウスまたは SQL の分析エンドポイントを作成するときに、既定のセマンティック モデルが自動的に作成され、親のレイクハウスまたはウェアハウスからビジネス ロジックを継承します。ここで行ったような、ご自身で作成するセマンティック モデルは、独自のニーズと好みに応じて設計および変更できるカスタム モデルです。カスタム セマンティック モデルを作成するには、Power BI Desktop、Power BI サービス、または Microsoft Fabric に接続するその他のツールを使用します。*

1. **リボンから [Open data model] (データ モデルを開く)** を選択します。

    ここで、テーブル間のリレーションシップを作成します。 Power BI Desktop でのリレーションシップの作成に慣れている方にとっては、見覚えのある内容です。

    *"スター スキーマの概念を確認しながら、モデル内のテーブルをファクト テーブルとディメンション テーブルに整理します。このモデルでは、**Trip** テーブルがファクト テーブルであり、ディメンションは **Date**、**Geography**、**Weather** です。"*

1. **DateID** 列を使用して、**Date** テーブルと **Trip** テーブルの間にリレーションシップを作成します。

    **Date** テーブルの **DateID 列を選択**し、*Trip テーブルの DateID 列の上にドラッグ アンド ドロップ*します。

    リレーションシップが、**Date** テーブルから **Trip** テーブルへの **1 対多**のリレーションシップであることを確認します。

1. 次のように、**Trip** ファクト テーブルに対してさらに 2 つのリレーションシップを作成します。

   - **Geography [GeographyID]** から **Trip [DropoffGeographyID]]** (1 対多)
   - **Weather [GeographyID]** から **Trip [DropoffGeographyID]** (1 対多)

    > **注**: 両方のリレーションシップについて、リレーションシップの既定のカーディナリティを **[1 対多]** に変更する必要があります。

1. テーブルをドラッグして、**Trip** ファクト テーブルが図の下部に配置され、残りのテーブル (ディメンション テーブル) がファクト テーブルの周囲に配置されるように位置を合わせます。

    ![スター スキーマの図のスクリーンショット](./Images/star-schema-diagram.png)

    "以上で、スター スキーマ モデルの作成が完了しました。階層の追加、計算、列表示などのプロパティの設定など、多数のモデリング構成を適用できるようになりました。"**

    > **ヒント**: ウィンドウの [プロパティ] ペインで、*[カードの一番上に関連フィールドをピン留めする]* を [はい] に切り替えます。 こうすると、ご自身 (およびこのモデルからレポートを作成する他のユーザー) が、リレーションシップで使用されているフィールドをひとめで確認できます。 また、[プロパティ] ペインを使用して、テーブル内のフィールドを操作することもできます。 たとえば、データ型が正しく設定されているか確認する場合は、フィールドを選択し、[プロパティ] ペインで形式を確認できます。

     ![[プロパティ] ペインのスクリーンショット](./Images/properties-pane.png)

## データを調査する

これで、レポートの作成に必要なリレーションシップが確立されたセマンティック モデルがウェアハウスから構築されました。 **データの探索**機能を使用して、データを見てみましょう。

1. ワークスペースに戻り、**Taxi Revenue セマンティック モデル**を選択します。

1. ウィンドウで、リボンから **[Explore this data] (このデータを探索)** を選択します。 ここでは、表形式でデータを見ていきます。 こうすると、完全な Power BI レポートを作成せずに、データを探索するための対象を絞ったエクスペリエンスが実現します。

1. **YearName** と **MonthName** を行に追加し、値フィールド ウェルで**平均乗客数**、**平均乗車量**、**平均乗車期間**を調べることができます。

    *"数値フィールドを探索ペインにドラッグ アンド ドロップすると、既定で数値が集計されます。集計を **[Summarize] (集計)** から **[平均]** に変更するには、フィールドを選択し、ポップアップ ウィンドウで集計を変更します。"*

    ![データの探索ウィンドウのスクリーンショット。マトリックス ビジュアルで時間の経過に伴った平均が示されています。](./Images/explore-data-fabric.png)

1. このデータを単なるマトリックスではなくビジュアルとして表示するには、ウィンドウの下部にある **[ビジュアル]** を選択します。 横棒グラフを選択すると、このデータをすばやく視覚化できます。

   *"横棒グラフは、このデータの表示方法として最適ではありません。画面の右側にある [データ] ペインの [Rearrange data] (データの並べ替え) セクションで、さまざまなビジュアルとフィールドを表示してみます。"*

1. この探索ビューをワークスペースに保存するには、左上隅にある **[保存]** ボタンをクリックします。 また、右上隅にある **[共有]** を選択してビューを**共有**することもできます。 これで、データ探索を同僚と共有できます。

1. 探索を保存したら、ワークスペースに戻り、データ ウェアハウス、既定のセマンティック モデル、作成したセマンティック モデル、ご自分の探索を確認します。

    ![データ ウェアハウス、既定のセマンティック モデル、セマンティック モデル、データ探索が表示された Fabric のワークスペースのスクリーンショット。](./Images/semantic-model-workspace.png)
