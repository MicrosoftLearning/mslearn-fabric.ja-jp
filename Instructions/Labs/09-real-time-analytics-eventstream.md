---
lab:
  title: Microsoft Fabric の Eventstream に関する概要
  module: Get started with Eventstream in Microsoft Fabric
---
# Real Time Analytics (RTA) での Eventstream の概要

Eventstream とは、コードなしのエクスペリエンスでリアルタイム イベントをキャプチャし、変換し、さまざまな宛先にルーティングする Microsoft Fabric の機能です。 変換が必要な場合は、イベントのデータ ソース、ルーティング先、イベント プロセッサを Eventstream に追加できます。 Microsoft Fabric の EventStore は、クラスターからのイベントを維持し、特定の時点でのクラスターまたはワークロードの状態を理解できるようにする監視オプションです。 EventStore サービスでは、クラスター内のエンティティとエンティティ型のそれぞれで使用できるイベントのクエリを実行できます。 つまり、クラスター、ノード、アプリケーション、サービス、パーティション、パーティション レプリカなど、さまざまなレベルのイベントにクエリを実行できます。 EventStore サービスは、クラスター内のイベントを関連付ける機能も備えています。 EventStore サービスは、相互に影響を与えた可能性がある異なるエンティティから同時に書き込まれたイベントを調べてそれらのイベントをリンクし、クラスター内で発生したアクティビティの原因の識別に役立てることができます。 Microsoft Fabric クラスターの監視と診断を行うもう 1 つのオプションが、EventFlow を使用したイベントの集計と収集です。

このラボの所要時間は約 **30** 分です。

> **注**:この演習を完了するには、[Microsoft Fabric 試用版](https://learn.microsoft.com/fabric/get-started/fabric-trial)が必要です。

## ワークスペースの作成

Fabric でデータを操作する前に、Fabric 試用版を有効にしてワークスペースを作成してください。

1. `https://app.fabric.microsoft.com` で [Microsoft Fabric](https://app.fabric.microsoft.com) にサインインし、 **[Power BI]** を選択してください。
2. 左側のメニュー バーで、 **[ワークスペース]** を選択します (アイコンは &#128455; に似ています)。
3. 任意の名前で新しいワークスペースを作成し、Fabric 容量を含むライセンス モード ("試用版"、*Premium*、または *Fabric*) を選択してください。**
4. 新しいワークスペースを開くと次に示すように空のはずです。

   ![Power BI の空のワークスペースのスクリーンショット。](./Images/new-workspace.png)
5. Power BI ポータルの左下で、 **[Power BI]** アイコンを選択し、**Real-Time Analytics** エクスペリエンスに切り替えます。

## シナリオ

Fabric Eventstream を使用すると、イベント データを 1 か所で簡単に管理できます。 リアルタイム イベント データを収集し、変換し、目的の形式でさまざまな宛先に送信できます。 また、Eventstream を、Azure Event Hubs、KQL データベース、レイクハウスに簡単に接続することもできます。

このラボは、株式市場データと呼ばれるサンプル ストリーミング データに基づいています。 株式市場サンプル データは、時刻、シンボル、価格、数量などの事前設定されたスキーマ列を含む証券取引所のデータセットです。 このサンプル データを使用して、株価のリアルタイム イベントをシミュレートし、KQL データベースなどのさまざまな宛先で分析します。

リアルタイム分析のストリーミングおよびクエリ機能を使用して、株価統計に関する重要な質問に答えます。 このシナリオでは、KQL データベースなどの一部のコンポーネントを個別に手動で作成する代わりに、ウィザードを最大限に活用します。

このチュートリアルで学習する内容は次のとおりです。

- KQL データベースを作成する
- OneLake へのデータ コピーを有効にする
- Eventstream を作成する
- Eventstream から KQL データベースにデータをストリーミングする
- KQL と SQL を使用してデータを探索する

## KQL データベースを作成する

1. **Real-Time Analytics** で、 **[KQL データベース]** ボックスを選択します。

   ![KQL データベースの選択の画像](./Images/select-kqldatabase.png)

2. KQL データベースに**名前を付ける**ダイアログが表示されます

   ![KQL データベースの名前付けの画像](./Images/name-kqldatabase.png)

3. KQL データベースに、覚えやすい名前 (**MyStockData** など) を指定し、 **[作成]** を押します。

1. **[データベースの詳細]** パネルで、鉛筆アイコンを選択して OneLake で可用性を有効にします。

   ![OneLake の有効化の画像](./Images/enable-onelake-availability.png)

2. ボタンを **[アクティブ]** に切り替えてから、 **[完了]** を選択してください。

 > **注:**  フォルダーを選択する必要はありません。Fabric によって作成されます。

   ![OneLake トグルの有効化の画像](./Images/enable-onelake-toggle.png)

## Eventstream を作成する

1. メニュー バーで **[Real-Time Analytics]** を選択します (アイコンは ![rta ロゴ](./Images/rta_logo.png)に似ています)
2. **[新規]** で **[Eventstream (プレビュー)]** を選択します

   ![Eventstream の選択の画像](./Images/select-eventstream.png)

3. 使用する Eventstream に**名前を付ける**よう求められます。 Eventstream に覚えやすい名前 (**MyStockES** など) を指定し、**[作成]** ボタンを押します。

   ![Eventstream の名前付けの画像](./Images/name-eventstream.png)

## Eventstream のソースと宛先を確立する

1. Eventstream キャンバスで、ドロップダウン リストから **[新しいソース]** を選択し、 **[サンプル データ]** を選択します。

   ![Eventstream キャンバスの画像](./Images/real-time-analytics-canvas.png)

2. 次の表に示すように、サンプル データの値を入力し、**[追加]** を選択します。

   | フィールド       | 推奨値 |
   | ----------- | ----------------- |
   | ソース名 | StockData         |
   | サンプル データ | 株式市場      |

3. 次に、 **[新しい宛先]** を選択して宛先を追加してから、 **[KQL データベース]** を選択します

   ![Eventstream の宛先の画像](./Images/new-kql-destination.png)

4. KQL データベースの構成で、次の表を使用して構成を完了します。

   | フィールド            | 推奨値                              |
   | ---------------- | ---------------------------------------------- |
   | 宛先名 | MyStockData                                    |
   | ワークスペース        | KQL データベースを作成したワークスペース |
   | KQL データベース     | MyStockData                                    |
   | [ターゲット テーブル]| MyStockData                                    |
   | 入力データ形式| JSON                                           |

3. **[追加]** を選択します。

> **注**:データ インジェストはすぐに開始されます。

すべてのステップが緑色のチェックマークでマークされるまで待ちます。 **[Eventsream からの継続的な取り込みが確立されました]** というページ タイトルが表示されるはずです。 その後、 **[閉じる]** を選択して Eventstream ページに戻ります。

> **注**:Eventstream 接続が構築されて確立された後、テーブルを表示するには、ページを更新する必要がある場合があります。

## KQL のクエリ

Kusto 照会言語 (KQL) は、データを処理して結果を返すための、読み取り専用の要求です。 要求は、読みやすく、作りやすく、自動化しやすいデータフロー モデルを利用してプレーンテキストで提示されます。 クエリは常に、特定のテーブルまたはデータベースのコンテキストで実行されます。 クエリは少なくとも、ソース データ参照と、シーケンスで適用される 1 つ以上のクエリ演算子で構成され、演算子を区切るパイプ文字 () を使用して視覚的に示されます。 Kusto 照会言語について詳しくは、「[Kusto 照会言語 (KQL) の概要](https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/?context=%2Ffabric%2Fcontext%2Fcontext)」を参照してください

> **注**: KQL エディターには構文と Inellisense 強調表示の両方が付属しています。これにより、Kusto 照会言語 (KQL) に関する知識をすばやく得ることができます。

1. **MyStockData** という名前の、新しく作成され、ハイドレートされた KQL データベースを参照します。
2. データ ツリーで、MyStockData テーブルのその他メニュー [...] を選択します。 次に、[クエリ テーブル] > [100 個のレコードを表示する] を選択します。

   ![KQL クエリ セットの画像](./Images/kql-query-sample.png)

3. サンプル クエリは、テーブル コンテキストが既に設定されている **[データを調査する]** ペインで開きます。 この最初のクエリは、take 演算子を使用してサンプル数のレコードを返します。データ構造と使用可能な値を最初に確認すると便利です。 自動設定されたサンプル クエリは自動的に実行されます。 結果ペインでクエリの結果を確認できます。

   ![KQL クエリ結果の画像](./Images/kql-query-results.png)

4. データ ツリーに戻り、次のクエリを選択します。このクエリは、where 演算子と between 演算子を使用して、過去 24 時間以内に取り込まれたレコードを返します。

   ![過去 24 時間の KQL クエリの結果の画像](./Images/kql-query-results-last24.png)

> **注**:クエリの制限を超えたという警告が表示される場合があります。 この動作は、データベースにストリーミングされるデータの量によって異なります。

引き続き、組み込みのクエリ関数の使用を試すことで、データを理解することができます。

## サンプル SQL クエリ

クエリ エディターでは、主要なクエリ Kusto 照会言語 (KQL) に加えて T-SQL の使用がサポートされています。 T-SQL は、KQL を使用できないツールで役立ちます。 詳細については、「[T-SQL を使用してデータのクエリを実行する](https://learn.microsoft.com/en-us/azure/data-explorer/t-sql)」を参照してください

1. データ ツリーに戻り、MyStockData テーブルで**その他メニュー** [...] を選択します。 **[クエリ テーブル] > [SQL] > [100 個のレコードを表示する]** を選択します。

   ![SQL クエリ サンプルの画像](./Images/sql-query-sample.png)

2. クエリ内のどこかにカーソルを置き、 **[実行]** を選択するか、**Shift キーを押しながら Enter キー**を押します。

   ![SQL クエリ結果の画像](./Images/sql-query-results.png)

引き続き、組み込みの関数の使用を試すことで、SQL または KQL を使用したデータを理解することができます。 これでレッスンは終了です。

## リソースをクリーンアップする

この演習では、KQL データベースを作成し、Eventstream を使用して継続的ストリーミングを設定しました。 その後、KQL と SQL を使用してデータにクエリを実行しました。 KQL データベースの探索が完了したら、この演習用に作成したワークスペースを削除できます。
1. 左側のバーで、ワークスペースのアイコンを選択します。
2. ツール バーの **[...]** メニューで、 **[ワークスペースの設定]** を選択します。
3. **[全般]** セクションで、**[このワークスペースの削除]** を選択します。
