---
lab:
  title: Microsoft Fabric のリアルタイム インテリジェンスの使用を開始する
  module: Get started with Real-Time Intelligence in Microsoft Fabric
---

# Microsoft Fabric のリアルタイム インテリジェンスの使用を開始する

Microsoft Fabric には、リアルタイム データ ストリーム用の分析ソリューションを作成できるリアルタイム ハブが用意されています。 この演習では、Microsoft Fabric のリアルタイム インテリジェンス機能の主な機能をいくつか調べて、それらを理解します。

このラボの所要時間は約 **30** 分です。

> **注**: この演習を完了するには、[Microsoft Fabric テナント](https://learn.microsoft.com/fabric/get-started/fabric-trial)が必要です。

## ワークスペースの作成

Fabric でデータを操作する前に、Fabric 容量を有効にしてワークスペースを作成する必要があります。

1. `https://app.fabric.microsoft.com/home?experience=fabric` の [Microsoft Fabric ホーム ページ](https://app.fabric.microsoft.com/home?experience=fabric)で、**[リアルタイム インテリジェンス]** を選択します。
1. 左側のメニュー バーで、 **[ワークスペース]** を選択します (アイコンは &#128455; に似ています)。
1. 任意の名前で新しいワークスペースを作成し、Fabric 容量を含むライセンス モード ("試用版"、*Premium*、または *Fabric*) を選択します。**
1. 開いた新しいワークスペースは空のはずです。

    ![Fabric の空のワークスペースを示すスクリーンショット。](./Images/new-workspace.png)

## イベントハウスを作成する

ワークスペースが作成されたので、リアルタイム インテリジェンス ソリューションに必要な Fabric 項目の作成を開始できます。 まず、リアルタイム データ用の KQL データベースを含むイベントハウスを作成します。

1. 左側のメニュー バーで **[ホーム]** を選択し、リアルタイム インテリジェンス ホーム ページで新しい **Eventhouse** を作成し、任意の一意の名前を付けます。
1. 新しい空のイベントハウスが表示されるまで、表示されているヒントまたはプロンプトを閉じます。

    ![新しいイベントハウスのスクリーンショット](./Images/create-eventhouse.png)

1. 左側のペインで、イベントハウスに Eventhouse と同じ名前の KQL データベースが含まれていることに注意してください。 このデータベースでは、リアルタイム データ用のテーブルを作成することも、必要に応じて追加のデータベースを作成することもできます。
1. データベースを選択し、関連付けられた *queryset* があることに注意してください。 このファイルには、データベース内のテーブルのクエリを開始するために使用できる KQL クエリのサンプルがいくつか含まれています。

    ただし、現時点ではクエリを実行するテーブルはありません。 Eventstream を使用していくつかのデータをデータベースに取り込んで、この問題を解決してみましょう。

## イベントストリームを作成する

1. KQL データベースのメイン ページで、 **[データの取得]** を選択します。
2. データ ソースで、**[Eventstream** > **新しい Eventstream]** を選択します。 Eventstream `stock-stream` に名前を付けます。

    新しい Eventstream の作成はすぐに完了します。 確立が完了すると、プライマリ エディターに自動的にリダイレクトされ、ソースをイベント ストリームに統合する準備が整います。

    ![新しい Eventstream のスクリーンショット。](./Images//name-eventstream.png)

1. Eventstream キャンバスで、**[サンプル データの使用]** を選択します。
1. ソース `Stock` に名前を付けて、**Stock Market** サンプル データを選択します。

    ストリームがマップされ、**Eeventstream キャンバス**に自動的に表示されます。

   ![Eventstream キャンバスのスクリーンショット。](./Images/new-stock-stream.png)

1. **変換イベントまたは変換先を追加する**ドロップダウン リストの **[変換先]** セクションで、**Eventhouse** を選択します。
1. **Eventhouse** ペインで、次のセットアップ オプションを構成します。
   - **データ インジェスト モード:** インジェスト前イベント処理
   - **変換先の名前:**`stock-table`
   - **ワークスペース: ***この演習の開始時に作成したワークスペースを選択します*
   - **Eventhouse**: *イベントハウスを選択します*
   - **KQL データベース: ***Eventhouse KQL データベースを選択します*
   - **変換先テーブル:** `stock` という名前の新しいテーブルを作成します
   - **入力データ形式:** JSON

   ![KQL データベース Eventstream とインジェスト モード](./Images/configure-destination.png)

1. **Eventhouse** ペインで、**[保存]** を選択します。
1. ツールバーの **[発行]** を選択します。
1. データ変換先がアクティブになるまで 1 分ほど待ちます。

    この演習では、リアルタイム データをキャプチャしてテーブルに読み込む非常にシンプルな Eventstream を作成しました。 実際のソリューションでは、通常、一時的なウィンドウでデータを集計する変換を追加します (たとえば、5 分間にわたる各株式の平均価格をキャプチャする)。

    次に、キャプチャしたデータに対してクエリを実行して分析する方法を見てみましょう。

## キャプチャされたデータに対してクエリを実行する

Eventstream は、リアルタイムの株式市場のデータをキャプチャし、KQL データベースのテーブルに読み込みます。 このテーブルに対してクエリを実行し、キャプチャされたデータを確認できます。

1. 左側のメニュー バーで、Eventhouse データベースを選択します。
1. データベースの *queryset* を選択します。
1. クエリ ペインで、次に示すように最初のクエリ例を変更します。

    ```kql
    stock
    | take 100
    ```

1. クエリ コードを選択して実行し、テーブルの 100 行のデータを表示します。

    ![KQL クエリのスクリーンショット。](./Images/kql-stock-query.png)

1. 結果を確認し、クエリを変更して、過去 5 分間の各株式コードの平均価格を取得します。

    ```kql
    stock
    | where ["time"] > ago(5m)
    | summarize avgPrice = avg(todecimal(bidPrice)) by symbol
    | project symbol, avgPrice
    ```

1. 変更したクエリを強調表示し、クエリを実行して結果を表示します。
1. 数秒待ってから、もう一度実行します。リアルタイム ストリームから新しいデータがテーブルに追加されると、平均価格が変化することに注意します。

## リアルタイム ダッシュ ボードの作成

データのストリームによってデータが設定されるテーブルが作成されたので、リアルタイム ダッシュボードを使用してデータを視覚化できます。

1. クエリ エディターで、過去 5 分間の平均株価を取得するために使用した KQL クエリを選択します。
1. ツールバーで、**[ダッシュボードにピン留めする]** を選択します。 次に、**新しいダッシュボードで**次の設定を使用してクエリをピン留めします。
    - **ダッシュボード名**: `Stock Dashboard`
    - **タイル名**: `Average Prices`
1. ダッシュボードを作成して開きます。 次のようになります。

    ![新しいダッシュボードのスクリーンショット。](./Images/stock-dashboard-table.png)

1. ダッシュボードの上部で、**表示**モードから**編集**モードに切り替えます。
1. **平均価格**タイルの**編集**アイコン (*鉛筆アイコン*) を選択します。
1. **[ビジュアルの書式設定]** ペインで、**[ビジュアル]** を *[テーブル]* から *[縦棒グラフ]* に変更します。

    ![編集中のダッシュボード タイルのスクリーンショット。](./Images/edit-dashboard-tile.png)

1. ダッシュボードの上部で、**[変更の適用]** を選択し、変更したダッシュボードを表示します。

    ![ダッシュボードとグラフ タイルのスクリーンショット。](./Images/stock-dashboard-chart.png)

    これで、リアルタイムの株価データをライブで視覚化できるようになりました。

## アラートを作成する

Microsoft Fabric のリアルタイム インテリジェンスには、リアルタイム イベントに基づいてアクションをトリガーできる *Activator* という名前のテクノロジが含まれています。 これを使用して、平均株価が特定の金額で増加したときにアラートが生成されるようにしてみましょう。

1. 株価の視覚化を含むダッシュボード ウィンドウのツール バーで、**[アラートの設定]** を選択します。
1. **[アラートの設定]** ペインで、次の設定を使用してアラートを作成します。
    - **[クエリの実行間隔]**: 5 分
    - **チェック**: イベントのグループ化のたびに
    - **グループ化フィールド**: 記号
    - **タイミング**: avgPrice
    - **条件**: Increases by
    - **値**: 100
    - **アクション**: メールを送信する
    - **保存場所**
        - **ワークスペース**: *ワークスペース*
        - **項目**: 新しい項目を作成します
        - **新しい項目名**: "*任意の一意の名前*

    ![アラート設定のスクリーンショット。](./Images/configure-activator.png)

1. アラートを作成し、保存されるまで待ちます。 次に、作成されたことを確認するペインを閉じます。
1. 左側のメニュー バーで、ワークスペースのページを選択します (メッセージが表示されたら、保存されていない変更をダッシュボードに保存します)。
1. ワークスペース ページで、アラートのアクティベーターを含め、この演習で作成した項目を表示します。
1. アクティベーターを開き、そのページの **avgPrice** ノードで、アラートの一意識別子を選択します。 次に、その**履歴**タブを表示します。

    アラートがトリガーされていない場合があります。その場合、履歴にデータは含まれていません。 平均株価が 100 を超えて変化した場合、アクティベーターからメールが送信され、アラートが履歴に記録されます。

## リソースをクリーンアップする

この演習では、Eventhouse を作成し、Eventstream を使用してリアルタイム データを取り込み、KQL データベース テーブルで取り込まれたデータのクエリを実行し、リアルタイム データを視覚化するリアルタイム ダッシュボードを作成し、アクティベーターを使用してアラートを構成しました。

Fabric のリアルタイム インテリジェンスの探索が終了したら、この演習用に作成したワークスペースを削除できます。

1. 左側のバーで、ワークスペースのアイコンを選択します。
2. ツール バーの **[ワークスペース設定]** を選択します。
3. **[全般]** セクションで、**[このワークスペースの削除]** を選択します。
