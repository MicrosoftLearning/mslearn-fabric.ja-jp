---
lab:
  title: Microsoft Fabric のリアルタイム インテリジェンスの使用を開始する
  module: Get started with Real-Time Intelligence in Microsoft Fabric
---

# Microsoft Fabric のリアルタイム インテリジェンスの使用を開始する

Microsoft Fabric には、リアルタイム データ ストリーム用の分析ソリューションを作成できるリアルタイム インテリジェンスが用意されています。 この演習では、Microsoft Fabric のリアルタイム インテリジェンス機能を使用して、株価市場データのリアルタイム ストリームを取り込み、分析し、視覚化します。

このラボの所要時間は約 **30** 分です。

> **注**: この演習を完了するには、[Microsoft Fabric テナント](https://learn.microsoft.com/fabric/get-started/fabric-trial)が必要です。

## ワークスペースの作成

Fabric でデータを操作する前に、Fabric 容量を有効にしてワークスペースを作成する必要があります。

1. ブラウザーの `https://app.fabric.microsoft.com/home?experience=fabric` で [Microsoft Fabric ホーム ページ](https://app.fabric.microsoft.com/home?experience=fabric)に移動し、Fabric 資格情報でサインインします。
1. 左側のメニュー バーで、 **[ワークスペース]** を選択します (アイコンは &#128455; に似ています)。
1. 任意の名前で新しいワークスペースを作成し、Fabric 容量を含むライセンス モード ("試用版"、*Premium*、または *Fabric*) を選択します。**
1. 開いた新しいワークスペースは空のはずです。

    ![Fabric の空のワークスペースを示すスクリーンショット。](./Images/new-workspace.png)

## Eventstream を作成する

これで、ストリーミング ソースからリアルタイム データを検索して取り込む準備ができました。 これを行うには、Fabric リアルタイム ハブから開始します。

> **ヒント**: 初めてリアルタイム ハブを使用する場合は、*はじめに*のヒントが表示される場合があります。 これらを閉じることができます。

1. 左側のメニュー バーで、**リアルタイム** ハブを選択します。

    リアルタイム ハブを使用すると、ストリーミング データのソースを簡単に見つけて管理できます。

    ![Fabric のリアルタイム ハブのスクリーンショット。](./Images/real-time-hub.png)

1. リアルタイム ハブの**接続先**セクションで、**[データ ソース]** を選択します。
1. **株式市場 (Stock Market)** サンプル データ ソースを見つけて、**[接続]** を選択します。 次に、**接続**ウィザードで、ソースに `stock` という名前を付け、既定のイベントストリーム名を編集して `stock-data` に変更します。 このデータに関連付けられている既定のストリームには、*stock-data-stream* という名前が自動的に付けられます。

    ![新しい Eventstream のスクリーンショット。](./Images/name-eventstream.png)

1. **[次へ]**、**[接続]** の順に選択し、ソースと Eventstream が作成されるまで待ってから、**[Eventstream を開く]** を選択します。 イベントストリームには、デザイン キャンバスに**stock**ソースと **stock-data-stream** が表示されます。

   ![Eventstream キャンバスのスクリーンショット。](./Images/new-stock-stream.png)

## イベントハウスを作成する

イベントストリームはリアルタイムの株式データを取り込みますが、現時点では何もしません。 キャプチャしたデータをテーブルに格納できるイベントハウスを作成しましょう。

1. 左側のメニュー バーで、**[作成]** を選択します。 *[新規]* ページの *[Real-Time Intelligence]* セクションで、**[イベントハウス]** を選択します。 任意の一意の名前を設定します。

    >**注**: **[作成]** オプションがサイド バーにピン留めされていない場合は、最初に省略記号 (**...**) オプションを選択する必要があります。

    新しい空のイベントハウスが表示されるまで、表示されているヒントまたはプロンプトを閉じます。

    ![新しいイベントハウスのスクリーンショット](./Images/create-eventhouse.png)

1. 左側のペインで、イベントハウスに Eventhouse と同じ名前の KQL データベースが含まれていることに注意してください。 このデータベースでは、リアルタイム データ用のテーブルを作成することも、必要に応じて追加のデータベースを作成することもできます。
1. データベースを選択し、関連付けられた *queryset* があることに注意してください。 このファイルには、データベース内のテーブルのクエリを開始するために使用できる KQL クエリのサンプルがいくつか含まれています。

    ただし、現時点ではクエリを実行するテーブルはありません。 イベントストリームから新しいテーブルにデータを取得することで、この問題を解決しましょう。

1. KQL データベースのメイン ページで、 **[データの取得]** を選択します。
1. データ ソースで、**[イベントストリーム]**、**[新しいイベントストリーム]** を選択します。
1. **[選択またはコピー先テーブルの作成]** ウィンドウで、`stock` という名前の新しいテーブルを作成します。 次に、**[データ ソースの構成]** ウィンドウで、ワークスペースと **stock-data** イベントストリームを選択し、接続 `stock-table` に名前を付けます。

   ![イベントストリームからテーブルを読み込むための構成のスクリーンショット。](./Images/configure-destination.png)

1. **[次へ]** ボタンを使用して、データを検査し、構成を完了する手順を完了します。 次に、構成ウィンドウを閉じて、イベントハウスと stock テーブルを表示します。

   ![テーブルを含むイベントハウスのスクリーンショット。](./Images/eventhouse-with-table.png)

    ストリームとテーブルの間の接続が作成されました。 イベントストリームでそのことを確認しましょう。

1. 左側のメニュー バーで、**リアルタイム** ハブを選択します。 **stock-data-stream** ストリームの **[...]** メニューで、**[イベントストリームを開く]** を選択します。

    イベントストリームにストリームの宛先が表示されるようになりました。

   ![コピー先を含むイベントストリームのスクリーンショット。](./Images/eventstream-destination.png)

    > **ヒント**: デザイン キャンバス上のコピー先を選択し、その下にデータ プレビューが表示されない場合は、**[更新する]** を選択します。

    この演習では、リアルタイム データをキャプチャしてテーブルに読み込む非常にシンプルな Eventstream を作成しました。 実際のソリューションでは、通常、変換を追加して、時間枠にわたってデータを集計します (たとえば、5 分間の各株の平均価格を取得する場合)。

    次に、キャプチャしたデータに対してクエリを実行して分析する方法を見てみましょう。

## キャプチャされたデータに対してクエリを実行する

Eventstream は、リアルタイムの株式市場のデータをキャプチャし、KQL データベースのテーブルに読み込みます。 このテーブルに対してクエリを実行し、キャプチャされたデータを確認できます。

1. 左側のメニュー バーで、Eventhouse データベースを選択します。
1. データベースの *queryset* を選択します。
1. クエリ ペインで、次に示すように最初のクエリ例を変更します。

    ```kql
    stock
    | take 100
    ```

1. クエリ コードを選択して実行し、テーブルの 100 行のデータを表示します。

    ![KQL クエリのスクリーンショット。](./Images/kql-stock-query.png)

1. 結果を確認し、クエリを変更して、過去 5 分間の各株式コードの平均価格を取得します。

    ```kql
    stock
    | where ["time"] > ago(5m)
    | summarize avgPrice = avg(todecimal(bidPrice)) by symbol
    | project symbol, avgPrice
    ```

1. 変更したクエリを強調表示し、クエリを実行して結果を表示します。
1. 数秒待ってから、もう一度実行します。リアルタイム ストリームから新しいデータがテーブルに追加されると、平均価格が変化することに注意します。

## リアルタイム ダッシュ ボードの作成

データのストリームによってデータが設定されるテーブルが作成されたので、リアルタイム ダッシュボードを使用してデータを視覚化できます。

1. クエリ エディターで、過去 5 分間の平均株価を取得するために使用した KQL クエリを選択します。
1. ツール バーの **[ダッシュボードに保存]** を選択します。 次に、**新しいダッシュボードで**次の設定を使用してクエリをピン留めします。
    - **ダッシュボード名**: `Stock Dashboard`
    - **タイル名**: `Average Prices`
1. ダッシュボードを作成して開きます。 次のようになります。

    ![新しいダッシュボードのスクリーンショット。](./Images/stock-dashboard-table.png)

1. ダッシュボードの右上にある、**[表示]** モードを **[編集]** モードに切り替えます。
1. **平均価格**タイルの**編集**アイコン (*鉛筆アイコン*) を選択します。
1. **[ビジュアルの書式設定]** ペインで、**[ビジュアル]** を *[テーブル]* から *[縦棒グラフ]* に変更します。

    ![編集中のダッシュボード タイルのスクリーンショット。](./Images/edit-dashboard-tile.png)

1. ダッシュボードの上部で、**[変更の適用]** を選択し、変更したダッシュボードを表示します。

    ![ダッシュボードとグラフ タイルのスクリーンショット。](./Images/stock-dashboard-chart.png)

    これで、リアルタイムの株価データをライブで視覚化できるようになりました。

## アラートを作成する

Microsoft Fabric のリアルタイム インテリジェンスには、リアルタイム イベントに基づいてアクションをトリガーできる *Activator* という名前の機能が含まれています。 これを使用して、平均株価が特定の金額で増加したときにアラートが生成されるようにしてみましょう。

1. 株価の視覚化を含むダッシュボード ウィンドウのツール バーで、**[アラートの設定]** を選択します。
1. **[アラートの設定]** ペインで、次の設定を使用してアラートを作成します。
    - **[クエリの実行間隔]**: 5 分
    - **チェック**: イベントのグループ化のたびに
    - **グループ化フィールド**: 記号
    - **タイミング**: avgPrice
    - **条件**: Increases by
    - **値**: 100
    - **アクション**: メールを送信する
    - **保存場所**
        - **ワークスペース**: *ワークスペース*
        - **項目**: 新しい項目を作成します
        - **新しい項目名**: "*任意の一意の名前*

    ![アラート設定のスクリーンショット。](./Images/configure-activator.png)

1. アラートを作成し、保存されるまで待ちます。 次に、作成されたことを確認するペインを閉じます。
1. 左側のメニュー バーで、ワークスペースのページを選択します (メッセージが表示されたら、保存されていない変更をダッシュボードに保存します)。
1. ワークスペース ページで、アラートのアクティベーターを含め、この演習で作成した項目を表示します。
1. アクティベーターを開き、そのページの **avgPrice** ノードで、アラートの一意識別子を選択します。 次に、その**履歴**タブを表示します。

    アラートがトリガーされていない場合があります。その場合、履歴にデータは含まれていません。 平均株価が 100 を超えて変化した場合、アクティベーターからメールが送信され、アラートが履歴に記録されます。

## リソースをクリーンアップする

この演習では、Eventhouse を作成し、Eventstream を使用してリアルタイム データを取り込み、KQL データベース テーブルで取り込まれたデータのクエリを実行し、リアルタイム データを視覚化するリアルタイム ダッシュボードを作成し、アクティベーターを使用してアラートを構成しました。

Fabric のリアルタイム インテリジェンスの探索が終了したら、この演習用に作成したワークスペースを削除できます。

1. 左側のバーで、ワークスペースのアイコンを選択します。
2. ツール バーで、**[ワークスペース設定]** を選択します。
3. **[全般]** セクションで、**[このワークスペースの削除]** を選択します。
