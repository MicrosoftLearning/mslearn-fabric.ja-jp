---
lab:
  title: Microsoft Fabric での Real-Time Analytics の概要
  module: Get started with real-time analytics in Microsoft Fabric
---

# Microsoft Fabric での Real-Time Analytics の概要

Microsoft Fabric には、Kusto 照会言語 (KQL) を使ってデータの保存とクエリを行うために使用できるランタイムが用意されています。 Kusto は、ログ ファイルや IoT デバイスからのリアルタイム データなどの時系列コンポーネントを含むデータ向けに最適化されています。

このラボの所要時間は約 **30** 分です。

> **注**:この演習を完了するには、Microsoft の "学校" または "職場" アカウントが必要です。**** お持ちでない場合は、[Microsoft Office 365 E3 以降の試用版にサインアップ](https://www.microsoft.com/microsoft-365/business/compare-more-office-365-for-business-plans)できます。

## ワークスペースの作成

Fabric でデータを操作する前に、Fabric 試用版を有効にしてワークスペースを作成してください。

1. [Microsoft Fabric ホーム ページ](https://app.fabric.microsoft.com)で、**Synapse Real-Time Analytics** を選択します。
1. 左側のメニュー バーで、 **[ワークスペース]** を選択します (アイコンは &#128455; に似ています)。
1. 任意の名前で新しいワークスペースを作成し、Fabric 容量を含むライセンス モード ("試用版"、*Premium*、または *Fabric*) を選択します。**
1. 開いた新しいワークスペースは空のはずです。

    ![Fabric の空のワークスペースを示すスクリーンショット。](./Images/new-workspace.png)

## KQL データベースのファイルをダウンロードする

ワークスペースが作成されたので、次に分析するデータ ファイルをダウンロードします。

1. [https://raw.githubusercontent.com/MicrosoftLearning/dp-data/main/sales.csv](https://raw.githubusercontent.com/MicrosoftLearning/dp-data/main/sales.csv) からこの演習用のデータ ファイルをダウンロードし、ローカル コンピューター (または該当する場合はラボ VM) に **sales.csv** として保存します。
1. **Microsoft Fabric** エクスペリエンスが表示されているブラウザー ウィンドウに戻ります。

## KQL データベースを作成する

Kusto クエリ言語 (KQL) は、KQL データベースで定義されているテーブル内の静的またはストリーミング データに対してクエリを実行するために使用されます。 売上データを分析するには、KQL データベースにテーブルを作成し、ファイルからデータを取り込む必要があります。

1. **Microsoft Fabric** エクスペリエンス ポータルで、次に示すように **Synapse Real-Time Analytics** エクスペリエンス イメージを選択します。

    ![RTA が選択されている、選択された Fabric Experience ホームのスクリーンショット](./Images/fabric-experience-home.png)

2. **Real-Time Analytics** エクスペリエンスの **[ホーム]** ページで、 **[KQL データベース]** を選択し、任意の名前の新しいデータベースを作成します。
3. 新しいデータベースが作成されたら、 **[ローカル ファイル]** からデータを取得するオプションを選択します。 次に、ウィザードを使用し、次のオプションを選択して新しいテーブルにデータをインポートします。
    - **[宛先]** :
        - **[データベース]** : *作成したデータベースが既に選択されています*
        - **Table**:[新しいテーブル] の左側にある + 記号をクリックして、**sales** "という新しいテーブルを作成します"。********

        ![新しいテーブル ウィザードの手順 1](./Images/import-wizard-local-file-1.png?raw=true)

        - 同じウィンドウに **[ファイルをここにドラッグ] または [ファイルの参照]** ハイパーリンクが表示されます。

        ![新しいテーブル ウィザードの手順 2](./Images/import-wizard-local-file-2.png?raw=true)

        - **sales.csv** を参照するか画面にドラッグし、[状態] ボックスが緑色のチェック ボックスに変わるまで待ち、**[次へ]** を選びます

        ![新しいテーブル ウィザードの手順 3](./Images/import-wizard-local-file-3.png?raw=true)

        - この画面で、列見出しが 1 行目にあり、システムによって検出されていますが、エラーが発生しないように、これらの行の上にあるスライダー **[1 行目は列ヘッダーです]** を動かす必要があります。
        
        ![新しいテーブル ウィザードの手順 4](./Images/import-wizard-local-file-4.png?raw=true)

        - このスライダーを選び、すべてが適切に表示されたら、パネルの右下にある **[完了]** ボタンを選びます。

        ![新しいテーブル ウィザードの手順 5](./Images/import-wizard-local-file-5.png?raw=true)

        - 概要画面で以下のような手順が完了するまで待ちます。
            - テーブル (sales) を作成する
            - マッピングを作成する (sales_mapping)
            - データ キュー
            - インジェスト
        - **[閉じる]** ボタンを選びます

        ![新しいテーブル ウィザードの手順 6](./Images/import-wizard-local-file-6.png?raw=true)

> **注**: この例では、ごく少量の静的データをファイルからインポートしました。この演習の目的のためにはそれで十分です。 実際には、Kusto を使用してもっと大量のデータ (Azure Event Hubs のようなストリーミング ソースからのデータなど) を分析できます。

## KQL を使用して売上テーブルのクエリを実行する

データベースにデータのテーブルができたので、KQL コードを使用してクエリを実行できます。

1. **sales** テーブルが強調表示されていることを確認します。 メニュー バーから **[クエリ テーブル]** ドロップダウンを選択し、そこから **[任意の 100 件のレコードを表示する]** を選択します。

2. 新しいペインが開き、クエリとその結果が表示されます。 

3. 次のように、クエリを変更します。

    ```kusto
   sales
   | where Item == 'Road-250 Black, 48'
    ```

4. クエリを実行します。 その後、結果を確認します。これには、*Road-250 Black, 48* 製品の販売注文の行のみが含まれています。

5. 次のように、クエリを変更します。

    ```kusto
   sales
   | where Item == 'Road-250 Black, 48'
   | where datetime_part('year', OrderDate) > 2020
    ```

6. クエリを実行し、結果を確認します。これには、2020 年より後に行われた *Road-250 Black, 48* の販売注文のみが含まれています。

7. 次のように、クエリを変更します。

    ```kusto
   sales
   | where OrderDate between (datetime(2020-01-01 00:00:00) .. datetime(2020-12-31 23:59:59))
   | summarize TotalNetRevenue = sum(UnitPrice) by Item
   | sort by Item asc
    ```

8. クエリを実行し、結果を確認します。これには、2020 年 1 月 1 日から 12 月 31 日までの各製品の合計純収益が製品名の昇順で含まれています。
9. **[KQL クエリセットとして保存]** を選択し、クエリを **Revenue by Product** として保存します。

## KQL クエリセットから Power BI レポートを作成する

Power BI レポートの基礎として KQL クエリセットを使用できます。

1. クエリ セットのクエリ ワークベンチ エディターで、クエリを実行し、結果を待ちます。
2. **[Power BI レポートを構築]** を選択し、レポート エディターが開くのを待ちます。
3. レポート エディターの **[データ]** ペインで、 **[Kusto クエリ結果]** を展開し、**Item** と **TotalRevenue** フィールドを選択します。
4. レポート デザイン キャンバスで、追加されたテーブルの視覚化を選択し、 **[視覚化]** ペインで **[集合横棒グラフ]** を選択します。

    ![KQL クエリからのレポートのスクリーンショット。](./Images/kql-report.png)

5. **Power BI** ウィンドウの **[ファイル]** メニューで、 **[保存]** を選択します。 次に、レイクハウスと KQL データベースが定義されているワークスペースで、 **[ビジネス以外]** の秘密度ラベルを使用して **Revenue by Item.pbix** としてレポートを保存します。
6. **Power BI** ウィンドウを閉じ、左側のバーでワークスペースのアイコンを選択します。

    必要に応じて [ワークスペース] ページを更新して、含まれるすべての項目を表示します。

7. ワークスペース内の項目の一覧に、**Revenue by Item** レポートが一覧表示されていることに注意してください。

## リソースをクリーンアップする

この演習では、レイクハウスにアップロードされたデータを分析する KQL データベースであるレイクハウスを作成しました。 KQL を使用してデータのクエリを実行し、クエリ セットを作成し、Power BI レポートの作成に使用しました。

KQL データベースの探索が完了したら、この演習用に作成したワークスペースを削除できます。

1. 左側のバーで、ワークスペースのアイコンを選択します。
2. ツール バーの **[...]** メニューで、 **[ワークスペースの設定]** を選択します。
3. **[その他]** セクションで、 **[このワークスペースの削除]** を選択してください。
